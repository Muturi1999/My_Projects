<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Bulk SMS Sender (Africa's Talking)</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 24px; }
    .container { max-width: 900px; margin: auto; }
    textarea { width: 100%; height: 120px; }
    input[type=file] { margin-bottom: 8px; }
    table { width: 100%; border-collapse: collapse; margin-top: 12px; }
    table th, table td { border: 1px solid #ddd; padding: 6px; text-align: left; }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <div class="container">
    <h1>Bulk SMS Sender (Africa's Talking)</h1>

    <% if (errors) { %>
      <div>
        <% errors.forEach(function(e){ %>
          <p class="error"><%= e %></p>
        <% }) %>
      </div>
    <% } %>

    <form action="/upload-and-send" method="post" enctype="multipart/form-data">
      <label><strong>Upload Excel/CSV (columns: name, phone/mobile/number)</strong></label><br/>
      <input type="file" name="contactsFile" accept=".xlsx,.xls,.csv" /><br/>

      <label><strong>Or paste numbers (each line: Name,number  OR  number)</strong></label><br/>
      <textarea name="pastedNumbers" placeholder="John Doe,0712345678\n0723456789"></textarea><br/>

      <label><strong>Message (use {{name}} or {{username}} to include contact name)</strong></label><br/>
      <textarea name="message" placeholder="Dear {{name}}, your event is on Friday..."></textarea><br/>

      <button type="submit">Send SMS to all</button>
    </form>

    <% if (preview) { %>
      <h3>Preview (first 200 contacts)</h3>
      <table>
        <thead><tr><th>#</th><th>Name</th><th>Phone</th></tr></thead>
        <tbody>
        <% preview.forEach(function(c, i){ %>
          <tr><td><%= i+1 %></td><td><%= c.name %></td><td><%= c.phone %></td></tr>
        <% }) %>
        </tbody>
      </table>
    <% } %>

    <% if (results) { %>
      <h3>Send Results</h3>
      <table>
        <thead><tr><th>#</th><th>Name</th><th>Phone</th><th>Status</th><th>Info</th></tr></thead>
        <tbody>
        <% results.forEach(function(r, i){ %>
          <tr>
            <td><%= i+1 %></td>
            <td><%= r.name %></td>
            <td><%= r.phone %></td>
            <td class="<%= r.success ? 'success' : 'error' %>"><%= r.success ? 'OK' : 'FAILED' %></td>
            <td><%= r.success ? 'MessageQueued' : (r.error || 'Unknown error') %></td>
          </tr>
        <% }) %>
        </tbody>
      </table>
    <% } %>

  </div>
</body>
</html>
